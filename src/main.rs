#![cfg_attr(debug_assertions, allow(dead_code))]

use rand::Rng;
#[macro_use]
extern crate timeit;

// ================================== UTILS ==================================

fn add_binary(b1: &str, b2: &str) -> String {
    // this function takes two string representing two binaries, transform them into
    // a vector of boolean; call the add function and transform back the result into
    // a string
    let res = add_binary_par(&cast_binary(b1), &cast_binary(b2), b1.len() - 4).1;
    return res.iter().map(|x| if *x {'1'} else {'0'}).rev().collect();
}

fn cast_binary(binary_str: &str) -> Vec<bool> {
    // transform the binary string into a vec of bolean, in reversed order
    return binary_str.chars().map(|x| x == '1').rev().collect();
}

fn random_binary(n: usize) -> Vec<bool> {
    let mut rng = rand::thread_rng();
    return std::iter::repeat_with(|| rng.gen::<bool>()).take(n).collect();
}

// ================================ ALGORITHMS ================================

/*fn add_binary_seq(b1: Vec<bool>, b2: Vec<bool>) -> (bool, Vec<bool>) {
    // this is the sequential algorithm for binary of different sizes
    // I decided to stick with binaries of equal length anyway
    return b1.iter().zip_longest(b2.iter()).map(|pair|
        match pair {
            Both(l, r) => (l, r),
            Left(l)    => (l, &false),
            Right(r)   => (&false, r)
        }
    ).fold((false, vec![]), |mut acc, curr| {
        let carry = acc.0;
        acc.0 = (carry as u8 + *curr.0 as u8 + *curr.1 as u8) > 1;
        acc.1.push(((carry as u8 + *curr.0 as u8 + *curr.1 as u8)%2) == 1);
        acc
    });
}*/

fn add_binary_seq(b1: &Vec<bool>, b2: &Vec<bool>) -> (bool, Vec<bool>) {
    return b1.iter().zip(b2.iter()).fold((false, vec![]), |mut acc, curr| {
        let carry = acc.0;
        acc.0 = (carry as u8 + *curr.0 as u8 + *curr.1 as u8) > 1;
        acc.1.push(((carry as u8 + *curr.0 as u8 + *curr.1 as u8)%2) == 1);
        acc
    });
}

fn add_binary_par(b1: &Vec<bool>, b2: &Vec<bool>, barrier: usize)
        -> (bool, Vec<bool>) {
    let b1len = b1.len();
    let b2len = b2.len();

    // PARALLEL
    if b1len > 1<<barrier && b2len > 1<<barrier {
        let (b1g, b1d) = b1.split_at(b1len/2);
        let (b2g, b2d) = b2.split_at(b2len/2);

        // splitting in two parts
        let ((c1, mut r1), (c2, r2)) = rayon::join(
            || add_binary_par(&b1g.to_vec(), &b2g.to_vec(), barrier),
            || add_binary_par(&b1d.to_vec(), &b2d.to_vec(), barrier)
        );

        // merging of the results
        let (c3, mut r3) = add_carry(r2, c1);
        r1.append(&mut r3);

        return (c2 || c3, r1);
    }

    // SEQUENTIAL
    return add_binary_seq(&b1, &b2);
}

fn add_carry(mut binary: Vec<bool>, carry: bool) -> (bool, Vec<bool>) {
    // add the carry (can be 0) to the binary
    // since the number are random, and thus having early 0s,
    // this algorithm should be O(1)
    if !carry {
        return (false, binary);
    }
    for i in 0..binary.len() {
        binary[i] = !binary[i];
        if binary[i] {
            return (false, binary);
        }
    }
    return (true, binary);
}

// =================================== MAIN ===================================

fn main() {
	let shift = 6;
    let n = 1 << shift;
    let barrier = shift - 4;

    let v1 = random_binary(n);
    let v2 = random_binary(n);

    println!(">>> Timing sequential algorithm");
    println!("{}", timeit_loops!(1000, {
        add_binary_seq(&v1, &v2);
    }));

    println!(">>> Timing parrallel algorithm");
    println!("{}", timeit_loops!(1000, {
        add_binary_par(&v1, &v2, barrier);
    }));
    

/*    println!(">>> Drawing the tracer graph");
    fast_tracer::svg("binary-add.svg", || {
        add_binary_par(&v1, &v2, barrier);
    })
    .expect("failed saving svg file");*/
}

// =================================== TESTS ===================================

#[cfg(test)]
mod tests {
    use crate::cast_binary;
    use crate::add_binary_seq;
    use crate::add_binary_par;

    #[test]
    fn zero_plus_zero_seq() {
        let b1 = cast_binary("00000000");
        let b2 = cast_binary("00000000");
        let res = cast_binary("00000000");
        assert_eq!(add_binary_seq(&b1, &b2).1, res);
    }

    #[test]
    fn eight_bits_seq() {
        let b1 = cast_binary("11001100");
        let b2 = cast_binary("11001100");
        let res = cast_binary("10011000");
        assert_eq!(add_binary_seq(&b1, &b2).1, res);
    }

    #[test]
    fn eight_bits_2_seq() {
        let b1 = cast_binary("11111111");
        let b2 = cast_binary("11111111");
        let res = cast_binary("11111110");
        assert_eq!(add_binary_seq(&b1, &b2).1, res);
    }

    #[test]
    fn larger_seq() {
        let b1 = cast_binary("0010110000001110");
        let b2 = cast_binary("0110001100100011");
        let res = cast_binary("1000111100110001");
        assert_eq!(add_binary_seq(&b1, &b2).1, res);
    }

    #[test]
    fn largest_seq() {
        let b1 = cast_binary("0111010011011010010110000110101101101111100111100010011110100011011101000111000111110010110100111011000101101010010101001011110100011000101000001000001010101111100101001011101001100001010110000011010010100011100100101111110100010001110011011011011111101011100100110001111100011100101010110110100000001011000010101100110110110011110100010001000111000100010000101111011000010010010010101110001110101000100111010101100100011111100000100100010101100011111010011110111100001101111010011111011100111100001111111100000011101001111101010100110101001100101000111110011001101111011101101110100110111111011101010111010110110010000010001001110111000100110101111100100011001111001111010100111010001111111101000011111100000101011111011001010110111101000000011111011001101011001110001011110100111011000001101101111110111110011100011101011100010001111001111111010011111001110011110001110011011100011010000000000011111100000011001111101011101011100000101001111010110000001010110001001101011101010100111001111010110111001011101000110111101110011010101010011111100000111001000101101100111100011111100111100100111101111101001110100011010011111010101101110011011100011111101001000011011100101110000101101010111011101001010011000001001110000110010101000000010001010010100000001000010010111111110001111101010000000000100101101101110111011100100100100110111110010110001111011100111011001011001101101010111111001111000011101100101000100010100000101110000111001001100100001101011110001001100101111000111101000101111010100100011000000001010010011101111101111000111110110110110100010100011010000110111010000000100110010111110001101000011110110011110011110011111011111110000111000001010001001111011111000001010111001101100101001101000000100010001111101101010001000011110010100100111010001101001011011001111100011011100110110101010100100010111000101111000000100101000011010100101000010011011001101110111010010100000001011010111010001001001001001011000101001110111011001110100011001011110111111001010000110100011100010000001000000001000011011000101001111000101010100010111011101110100000101000101001101001111101001000111010010011011110110001011010011011111000110001111110010111001011101100101000110001000011110011000100110111010010101100101111011110100110011011100110010111101100001100111010110111000100011110000101000011011001010011000000000001001100111101111111101011111011011010110110011011010100111010111010111010100110001100001101001011100100100010011111010011100000011010100111100010010011110000101010110100111101101000111100100000001111001101110110000100100010111001100110011000001011001011111010101011001100101011000001010101000011010110011100100000100000010001100110111111001111000100010010111100001000000010111101010101011110100100000011111110000011000000001001011001110110011111001110010111010111010001001111010110000000101011110100001001101001001100011110011010000100101110111000011111110111110001001100001001101011101100100100100111110101111011100001001000000010111011010101100110111101100100010110000101101110000111011111110011100011111110100110011110001001011111001101100111010010101100011000111011110011000101000111100110001001001011011111001011111000101100110100000011101100111000101100001101001100110110100110100100001101011011111011011111101000101011011000111101000010110010011001100110110011010101101011111101100110101001000011111100010110111100111100001010001100101101001100100010100001010111010100010110011100111101110000000000001001011001000011111011110100100000001110100011100000101011000011011111011001110000000100110010100111001100101111111111000101110111011011110000101010001111101110111010100111011010010000110000011111101001011110101110111011000000001011000100001001001101111000111111010001101110010010010000111000100010010111001100101000110001110111110111111101000010000000000001110110001110101101100110001111000110110010101101110111001010111100101010010101101011000111100000010011001100011111111011100010111001000010111011110110110101110001100010000110000101100101001000101011110010010111100010101100010000000100101010011011110010010111011010010011100000110110110000001100000001001110100000000111");
        let b2 = cast_binary("0101000100101001111011010001111100100001111111001101110101010011000101100001100011000000000000111000100000101100110111100110101101010001001010101110001011011110101111101110001000111101010010111101100100111111100110111000010110100000000000010100111001110001100110100000000101100101010101111100011000001101110100001111111111101000101010000001001001101001010101011010110000100101011100110101101110011110010101111000010101010010011011110011000101101110100011000101011001010000000000110111100010100010100110111010011101110111101000010110111001101110010000010101000000100101111101111101111111010100000110111110001010100110010011111011010101101111001100010010000010111000101110011010000001100100000001010001011000010011001001000111010101100111111000111111011100011011010110010001011101001110110100010001000100000101011010110100101000010111011000111000110101111110110001010000100000100000011000101011001100100111011111011010001111100110101101011001100110001010000111011001001010101100010110101011000110111010000011001101010011101000111101111110100111011001110100000001111101100010000001100000110001111000100001101010001001011101010011111010001011110101010100110001111111100011100001000011110100011111101001111100100100100101000100011111001110100000111101100100011110100001000111111011101010110000100111101110011001111001010111111101111111111001111000100101110000000010001100100001101011111110010001000011100111101110101010001000100100100010000000111011110000011000011101101000101001100000111011110001101001101011000100100101011111010100110111110001101111111001000101011000110111100110010100011000100010111001100111111110010111000100010110110101100010010110001111100001111000011101111001011000001010101100110001110101101011110110010000011001001110010111101000011011110001100001111100111011001010111001111011000110101000001110000100010111001001100000010100000110001011100110010010001010100001100101101011111101011110101011100101101111101000000000001001100100111001000010110010100111100111110010111110001011001100111101001001101111011001101101000110000111101011010010011111100000100101111010100000010010100100001101111000010111111110101001010000010111000011001111111000101111001010100011010011001010110011010011111011001001001010110110010001000111110000001000010111111100010010010011100010011111101000001111001110010101001111011000110100010011100000110000010100011101101010100111010010110111101001110111110110111101111011111000011110101010001110110110001100100000001000110111001000100101001110010100100111100011011011000011100000110011110101100000001001100101001111011010110010111100101101110111001100011100101100000001001111001110010100000110100101101011000000100101011010110010110011011110011010001011010111010101011101100010110011010110011011101010000110100000101111010011111010010000111011000110101101010010001101101011111110010010100001011100011001010001001000001111101001011011000110000110100111111001101111011001001001101100111001110001110011111001011101011010011111100111101101100100000010100000100101110100111111100101101110001101100011000001100001000111000001000111001100010011101110110001000100011000000001011111010111001101011110100110001100010011100110101010111101111101011101100110011100010100010000110001100101011101000011111110010010111111010100010011010110100110001111110111101111100010100101011001100000001100010010001111010111111101101101010100010100001010011111110100101011101000000010111101100011101010000110010110010011101010111101000000000010000001011111001010000010100110010100100110100101101011100111110000000101001000011110011100011001101110010000001111100100110010010101010010111111110111100000100000100010111100100110101111010111111111011111011100101111001000110010011000001101011101011001011001100011111010010111000001111001111111001001011011000100110001111011010011010001011011000001010110001111010010001011101000110010000010101011111010110101110011101110001110100000101010101101010101110111110011010110011000111011110111111111000100011001110010000110100010000011111011010000001001000101001101100000011110011111110100111111110010010011000111110010111100111000101011001100011010");
        let res = cast_binary("1100011000000100010001011000101010010001100110110000010011110110100010101000101010110010110101110011100110010111001100110010100001101001110010110110010110001110010100111001110010011110101001000000110111100011001011101000001010110001110011110000011001011101001011010010000010000010000000110010111000011000110110111100110110011100011110010010010000101101100110001010001000110111101111100011111101000110111101001101111001110001111100010111011011010010011101100100010101011101111011010110111111011110110110110110100001100001100101101011101110111010111001010011011010010101011011101100100110010011100100010101100001011000010110000101001100110100000010001110100110000111111101101110111011110011111110010101010100011000101000100000101100100100111001011110110110000110100100011101010010001001110101111111000011000011110111010010000100101001010010111000001001111000100101000010010011111100110010101011010000100011100010101001111011010010001110000011100000111010010010001010011000001001101011100101000001110001001110110110001011010111011000101001000110111010101101000111101010011110100001001000010110110110011110111000101100110001001110100111111111010001110100011011000011000000001111001001011111011011010011001111100101110011001010110100001110110010010000000100100110110100000111101101101000000000101000010100000111110000110100100010100110111000001110110101001100111101010111101111010110111101100000000111010100010111001100101001010010101001001010011111111101110110100111001110100010011110000001101100001110000011000101110111111101010010110000110000100110101101011001110010111110100000010100111110111010101011010000011101001010111000001010110001100000011101010000110011000111111100111010101111011000010001111110110110001110000101111101101010010010001010001101010101111110101101010110110111100110100000110000011011001011000110110011010111101110100011101000101110011111000000000001000100110101100111000110110111100111110100110000110100110110111011011000001000000100111010101011111000011100001111001110010011001110000000100010011001010010010111101001000011011001110011001000001010001111110111101001001100110111101100101001110010011010100010000010010101011010011011100101010111111011100111000110001111101010100110100111111000101001011100101100101110000111110100100100110111001001011000000000100100101011101000100001010101010000100101110010010011001100101011101111010100000101111100001101110010100100011110000011001011000111011101000001001001100010010110100111000111101011001010111001010000000011010010010000011111111011010010101110101001111010000011000011001011100111100101111110110111011001000011110111011110000001000100100101101010110100100110110111010001111111110100011111000101101111100110011101001000101100110100000001100110110001011001011011110011100000010111001110100010010001101000001100010110000011010010111001100000000111111011101101111010110011010101110111001000001001010010110111010010110001100101011011111101110001100010110101010010111011111100011000110000000110100101010001111010001000001110101101010100110011001001101100110100000001001011000000010100101000011001111000101100101010100100001001011111100111101000100010101100101010011110111001000111101010010111110110101001101010110011010010111010110100111111000001011000100011100110111110011000010001010110001000111111110110101011000101001110100011000000001001010000001110100110010100111001110111100001000001010111000010010110000010111100011001011010100001011010000110011111101100101110111000110100100010010000000010101010101101101001110100000000010101110000011010010111010001111000011101100010010001001010000000111001110100100001001111111010011010001000010001000000001100011011010101101010011000001010100011100101111101000001110001101001111011101111101010010010000110010001100011101010101011110111000001011000000110110001111101001001100000001000100111100101010110000100111001011111111100111111010110010000100000111011001110100001101101001010101000111000110000110110010010001111110001101001100001001010011111010111001111001101110110010010110010110101010101010010001010111010010010001100011010000101110011111110100011001000111001111001101100100001");
        assert_eq!(add_binary_seq(&b1, &b2).1, res);
    }

    #[test]
    fn zero_plus_zero_par() {
        let b1 = cast_binary("00000000");
        let b2 = cast_binary("00000000");
        let res = cast_binary("00000000");
        assert_eq!(add_binary_par(&b1, &b2, 8).1, res);
    }

    #[test]
    fn eight_bits_par() {
        let b1 = cast_binary("11001100");
        let b2 = cast_binary("11001100");
        let res = cast_binary("10011000");
        assert_eq!(add_binary_par(&b1, &b2, 8).1, res);
    }

    #[test]
    fn eight_bits_2_par() {
        let b1 = cast_binary("11111111");
        let b2 = cast_binary("11111111");
        let res = cast_binary("11111110");
        assert_eq!(add_binary_par(&b1, &b2, 8).1, res);
    }

    #[test]
    fn larger_par() {
        let b1 = cast_binary("0010110000001110");
        let b2 = cast_binary("0110001100100011");
        let res = cast_binary("1000111100110001");
        assert_eq!(add_binary_par(&b1, &b2, 8).1, res);
    }

    #[test]
    fn largest_par() {
        let b1 = cast_binary("0111010011011010010110000110101101101111100111100010011110100011011101000111000111110010110100111011000101101010010101001011110100011000101000001000001010101111100101001011101001100001010110000011010010100011100100101111110100010001110011011011011111101011100100110001111100011100101010110110100000001011000010101100110110110011110100010001000111000100010000101111011000010010010010101110001110101000100111010101100100011111100000100100010101100011111010011110111100001101111010011111011100111100001111111100000011101001111101010100110101001100101000111110011001101111011101101110100110111111011101010111010110110010000010001001110111000100110101111100100011001111001111010100111010001111111101000011111100000101011111011001010110111101000000011111011001101011001110001011110100111011000001101101111110111110011100011101011100010001111001111111010011111001110011110001110011011100011010000000000011111100000011001111101011101011100000101001111010110000001010110001001101011101010100111001111010110111001011101000110111101110011010101010011111100000111001000101101100111100011111100111100100111101111101001110100011010011111010101101110011011100011111101001000011011100101110000101101010111011101001010011000001001110000110010101000000010001010010100000001000010010111111110001111101010000000000100101101101110111011100100100100110111110010110001111011100111011001011001101101010111111001111000011101100101000100010100000101110000111001001100100001101011110001001100101111000111101000101111010100100011000000001010010011101111101111000111110110110110100010100011010000110111010000000100110010111110001101000011110110011110011110011111011111110000111000001010001001111011111000001010111001101100101001101000000100010001111101101010001000011110010100100111010001101001011011001111100011011100110110101010100100010111000101111000000100101000011010100101000010011011001101110111010010100000001011010111010001001001001001011000101001110111011001110100011001011110111111001010000110100011100010000001000000001000011011000101001111000101010100010111011101110100000101000101001101001111101001000111010010011011110110001011010011011111000110001111110010111001011101100101000110001000011110011000100110111010010101100101111011110100110011011100110010111101100001100111010110111000100011110000101000011011001010011000000000001001100111101111111101011111011011010110110011011010100111010111010111010100110001100001101001011100100100010011111010011100000011010100111100010010011110000101010110100111101101000111100100000001111001101110110000100100010111001100110011000001011001011111010101011001100101011000001010101000011010110011100100000100000010001100110111111001111000100010010111100001000000010111101010101011110100100000011111110000011000000001001011001110110011111001110010111010111010001001111010110000000101011110100001001101001001100011110011010000100101110111000011111110111110001001100001001101011101100100100100111110101111011100001001000000010111011010101100110111101100100010110000101101110000111011111110011100011111110100110011110001001011111001101100111010010101100011000111011110011000101000111100110001001001011011111001011111000101100110100000011101100111000101100001101001100110110100110100100001101011011111011011111101000101011011000111101000010110010011001100110110011010101101011111101100110101001000011111100010110111100111100001010001100101101001100100010100001010111010100010110011100111101110000000000001001011001000011111011110100100000001110100011100000101011000011011111011001110000000100110010100111001100101111111111000101110111011011110000101010001111101110111010100111011010010000110000011111101001011110101110111011000000001011000100001001001101111000111111010001101110010010010000111000100010010111001100101000110001110111110111111101000010000000000001110110001110101101100110001111000110110010101101110111001010111100101010010101101011000111100000010011001100011111111011100010111001000010111011110110110101110001100010000110000101100101001000101011110010010111100010101100010000000100101010011011110010010111011010010011100000110110110000001100000001001110100000000111");
        let b2 = cast_binary("0101000100101001111011010001111100100001111111001101110101010011000101100001100011000000000000111000100000101100110111100110101101010001001010101110001011011110101111101110001000111101010010111101100100111111100110111000010110100000000000010100111001110001100110100000000101100101010101111100011000001101110100001111111111101000101010000001001001101001010101011010110000100101011100110101101110011110010101111000010101010010011011110011000101101110100011000101011001010000000000110111100010100010100110111010011101110111101000010110111001101110010000010101000000100101111101111101111111010100000110111110001010100110010011111011010101101111001100010010000010111000101110011010000001100100000001010001011000010011001001000111010101100111111000111111011100011011010110010001011101001110110100010001000100000101011010110100101000010111011000111000110101111110110001010000100000100000011000101011001100100111011111011010001111100110101101011001100110001010000111011001001010101100010110101011000110111010000011001101010011101000111101111110100111011001110100000001111101100010000001100000110001111000100001101010001001011101010011111010001011110101010100110001111111100011100001000011110100011111101001111100100100100101000100011111001110100000111101100100011110100001000111111011101010110000100111101110011001111001010111111101111111111001111000100101110000000010001100100001101011111110010001000011100111101110101010001000100100100010000000111011110000011000011101101000101001100000111011110001101001101011000100100101011111010100110111110001101111111001000101011000110111100110010100011000100010111001100111111110010111000100010110110101100010010110001111100001111000011101111001011000001010101100110001110101101011110110010000011001001110010111101000011011110001100001111100111011001010111001111011000110101000001110000100010111001001100000010100000110001011100110010010001010100001100101101011111101011110101011100101101111101000000000001001100100111001000010110010100111100111110010111110001011001100111101001001101111011001101101000110000111101011010010011111100000100101111010100000010010100100001101111000010111111110101001010000010111000011001111111000101111001010100011010011001010110011010011111011001001001010110110010001000111110000001000010111111100010010010011100010011111101000001111001110010101001111011000110100010011100000110000010100011101101010100111010010110111101001110111110110111101111011111000011110101010001110110110001100100000001000110111001000100101001110010100100111100011011011000011100000110011110101100000001001100101001111011010110010111100101101110111001100011100101100000001001111001110010100000110100101101011000000100101011010110010110011011110011010001011010111010101011101100010110011010110011011101010000110100000101111010011111010010000111011000110101101010010001101101011111110010010100001011100011001010001001000001111101001011011000110000110100111111001101111011001001001101100111001110001110011111001011101011010011111100111101101100100000010100000100101110100111111100101101110001101100011000001100001000111000001000111001100010011101110110001000100011000000001011111010111001101011110100110001100010011100110101010111101111101011101100110011100010100010000110001100101011101000011111110010010111111010100010011010110100110001111110111101111100010100101011001100000001100010010001111010111111101101101010100010100001010011111110100101011101000000010111101100011101010000110010110010011101010111101000000000010000001011111001010000010100110010100100110100101101011100111110000000101001000011110011100011001101110010000001111100100110010010101010010111111110111100000100000100010111100100110101111010111111111011111011100101111001000110010011000001101011101011001011001100011111010010111000001111001111111001001011011000100110001111011010011010001011011000001010110001111010010001011101000110010000010101011111010110101110011101110001110100000101010101101010101110111110011010110011000111011110111111111000100011001110010000110100010000011111011010000001001000101001101100000011110011111110100111111110010010011000111110010111100111000101011001100011010");
        let res = cast_binary("1100011000000100010001011000101010010001100110110000010011110110100010101000101010110010110101110011100110010111001100110010100001101001110010110110010110001110010100111001110010011110101001000000110111100011001011101000001010110001110011110000011001011101001011010010000010000010000000110010111000011000110110111100110110011100011110010010010000101101100110001010001000110111101111100011111101000110111101001101111001110001111100010111011011010010011101100100010101011101111011010110111111011110110110110110100001100001100101101011101110111010111001010011011010010101011011101100100110010011100100010101100001011000010110000101001100110100000010001110100110000111111101101110111011110011111110010101010100011000101000100000101100100100111001011110110110000110100100011101010010001001110101111111000011000011110111010010000100101001010010111000001001111000100101000010010011111100110010101011010000100011100010101001111011010010001110000011100000111010010010001010011000001001101011100101000001110001001110110110001011010111011000101001000110111010101101000111101010011110100001001000010110110110011110111000101100110001001110100111111111010001110100011011000011000000001111001001011111011011010011001111100101110011001010110100001110110010010000000100100110110100000111101101101000000000101000010100000111110000110100100010100110111000001110110101001100111101010111101111010110111101100000000111010100010111001100101001010010101001001010011111111101110110100111001110100010011110000001101100001110000011000101110111111101010010110000110000100110101101011001110010111110100000010100111110111010101011010000011101001010111000001010110001100000011101010000110011000111111100111010101111011000010001111110110110001110000101111101101010010010001010001101010101111110101101010110110111100110100000110000011011001011000110110011010111101110100011101000101110011111000000000001000100110101100111000110110111100111110100110000110100110110111011011000001000000100111010101011111000011100001111001110010011001110000000100010011001010010010111101001000011011001110011001000001010001111110111101001001100110111101100101001110010011010100010000010010101011010011011100101010111111011100111000110001111101010100110100111111000101001011100101100101110000111110100100100110111001001011000000000100100101011101000100001010101010000100101110010010011001100101011101111010100000101111100001101110010100100011110000011001011000111011101000001001001100010010110100111000111101011001010111001010000000011010010010000011111111011010010101110101001111010000011000011001011100111100101111110110111011001000011110111011110000001000100100101101010110100100110110111010001111111110100011111000101101111100110011101001000101100110100000001100110110001011001011011110011100000010111001110100010010001101000001100010110000011010010111001100000000111111011101101111010110011010101110111001000001001010010110111010010110001100101011011111101110001100010110101010010111011111100011000110000000110100101010001111010001000001110101101010100110011001001101100110100000001001011000000010100101000011001111000101100101010100100001001011111100111101000100010101100101010011110111001000111101010010111110110101001101010110011010010111010110100111111000001011000100011100110111110011000010001010110001000111111110110101011000101001110100011000000001001010000001110100110010100111001110111100001000001010111000010010110000010111100011001011010100001011010000110011111101100101110111000110100100010010000000010101010101101101001110100000000010101110000011010010111010001111000011101100010010001001010000000111001110100100001001111111010011010001000010001000000001100011011010101101010011000001010100011100101111101000001110001101001111011101111101010010010000110010001100011101010101011110111000001011000000110110001111101001001100000001000100111100101010110000100111001011111111100111111010110010000100000111011001110100001101101001010101000111000110000110110010010001111110001101001100001001010011111010111001111001101110110010010110010110101010101010010001010111010010010001100011010000101110011111110100011001000111001111001101100100001");
        assert_eq!(add_binary_par(&b1, &b2, 12).1, res);
    }
}
